(window.webpackJsonp=window.webpackJsonp||[]).push([[70],{546:function(a,s,t){"use strict";t.r(s);var r=t(2),e=Object(r.a)({},(function(){var a=this,s=a._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[s("h3",{attrs:{id:"官方步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#官方步骤"}},[a._v("#")]),a._v(" 官方步骤")]),a._v(" "),s("p",[s("a",{attrs:{href:"https://about.gitlab.com/install/#centos-7",target:"_blank",rel:"noopener noreferrer"}},[a._v("前往查看"),s("OutboundLink")],1)]),a._v(" "),s("h3",{attrs:{id:"服务器配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#服务器配置"}},[a._v("#")]),a._v(" 服务器配置")]),a._v(" "),s("ul",[s("li",[a._v("CentOS 7.9 64位")]),a._v(" "),s("li",[a._v("2核4GB")])]),a._v(" "),s("blockquote",[s("p",[a._v("官方建议RAM最低不小于4GB")])]),a._v(" "),s("h3",{attrs:{id:"安装ssh"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装ssh"}},[a._v("#")]),a._v(" 安装ssh")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" policycoreutils-python openssh-server perl\n")])])]),s("h3",{attrs:{id:"设置ssh服务开机自启动"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置ssh服务开机自启动"}},[a._v("#")]),a._v(" 设置SSH服务开机自启动")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" sshd\n")])])]),s("h3",{attrs:{id:"启动ssh服务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动ssh服务"}},[a._v("#")]),a._v(" 启动SSH服务")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start sshd\n")])])]),s("h3",{attrs:{id:"安装防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装防火墙"}},[a._v("#")]),a._v(" 安装防火墙")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" firewalld systemd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n")])])]),s("h3",{attrs:{id:"开启防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#开启防火墙"}},[a._v("#")]),a._v(" 开启防火墙")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("service")]),a._v(" firewalld start\n")])])]),s("h3",{attrs:{id:"添加http-https服务到firewalld"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加http-https服务到firewalld"}},[a._v("#")]),a._v(" 添加http/https服务到firewalld")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-service"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("http\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v(" --add-service"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("https\n")])])]),s("blockquote",[s("p",[a._v("pemmanent表示永久生效")])]),a._v(" "),s("h3",{attrs:{id:"选定一个可访问的端口-查询端口是否被占用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#选定一个可访问的端口-查询端口是否被占用"}},[a._v("#")]),a._v(" 选定一个可访问的端口，查询端口是否被占用")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("netstat")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-nap")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("grep")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v("\n")])])]),s("blockquote",[s("p",[a._v("如果没有输出任何信息，则说明端口没有被占用")])]),a._v(" "),s("h3",{attrs:{id:"防火墙开放端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#防火墙开放端口"}},[a._v("#")]),a._v(" 防火墙开放端口")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("firewall-cmd "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--zone")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("public --add-port"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),s("span",{pre:!0,attrs:{class:"token number"}},[a._v("8888")]),a._v("/tcp "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--permanent")]),a._v("\n")])])]),s("h3",{attrs:{id:"重启防火墙"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#重启防火墙"}},[a._v("#")]),a._v(" 重启防火墙")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl reload firewalld\n")])])]),s("h3",{attrs:{id:"安装postfix以发送通知邮件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装postfix以发送通知邮件"}},[a._v("#")]),a._v(" 安装Postfix以发送通知邮件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" postfix\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl "),s("span",{pre:!0,attrs:{class:"token builtin class-name"}},[a._v("enable")]),a._v(" postfix\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" systemctl start postfix\n")])])]),s("h3",{attrs:{id:"安装wget-用于从外网上下载插件"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装wget-用于从外网上下载插件"}},[a._v("#")]),a._v(" 安装wget 用于从外网上下载插件")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v("\n")])])]),s("h3",{attrs:{id:"安装vim编辑器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装vim编辑器"}},[a._v("#")]),a._v(" 安装vim编辑器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v("\n")])])]),s("h3",{attrs:{id:"添加gitlab镜像源"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加gitlab镜像源"}},[a._v("#")]),a._v(" 添加GitLab镜像源")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("wget")]),a._v(" https://mirrors.tuna.tsinghua.edu.cn/gitlab-ce/yum/el7/gitlab-ce-13.7.3-ce.0.el7.x86_64.rpm --no-check-certificate\n")])])]),s("blockquote",[s("p",[a._v("官方镜像太慢了，这里使用了清华源，要加上"),s("code",[a._v("--no-check-certificate")]),a._v("才可以")])]),a._v(" "),s("h3",{attrs:{id:"安装gitlab服务器"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab服务器"}},[a._v("#")]),a._v(" 安装GitLab服务器")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("rpm")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-i")]),a._v(" gitlab-ce-13.7.3-ce.0.el7.x86_64.rpm\n")])])]),s("h3",{attrs:{id:"修改gitlab配置文件指定服务器ip和自定义端口"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#修改gitlab配置文件指定服务器ip和自定义端口"}},[a._v("#")]),a._v(" 修改GitLab配置文件指定服务器ip和自定义端口")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("vim")]),a._v(" /etc/gitlab/gitlab.rb\n")])])]),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/19423820-44830168f115c3c0.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"更新gitlab配置"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#更新gitlab配置"}},[a._v("#")]),a._v(" 更新GitLab配置")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-ctl reconfigure\n")])])]),s("h3",{attrs:{id:"启动gitlab"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动gitlab"}},[a._v("#")]),a._v(" 启动GitLab")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-ctl restart\n")])])]),s("h3",{attrs:{id:"首次访问需要设置管理员密码-用户名是root"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#首次访问需要设置管理员密码-用户名是root"}},[a._v("#")]),a._v(" 首次访问需要设置管理员密码，用户名是root")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/19423820-5490628f2213280e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"安装node"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装node"}},[a._v("#")]),a._v(" 安装node")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sL")]),a._v(" https://rpm.nodesource.com/setup_14.x "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("bash")]),a._v(" -\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-y")]),a._v(" nodejs\n")])])]),s("h3",{attrs:{id:"安装yarn"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装yarn"}},[a._v("#")]),a._v(" 安装yarn")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-sL")]),a._v(" https://dl.yarnpkg.com/rpm/yarn.repo "),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("|")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("tee")]),a._v(" /etc/yum.repos.d/yarn.repo\n"),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" yum "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("yarn")]),a._v("\n")])])]),s("h3",{attrs:{id:"安装git"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装git"}},[a._v("#")]),a._v(" 安装git")]),a._v(" "),s("div",{staticClass:"language- extra-class"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[a._v("sudo yum install git\n")])])]),s("h3",{attrs:{id:"安装gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#安装gitlab-runner"}},[a._v("#")]),a._v(" 安装gitlab-runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("curl")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-L")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--output")]),a._v(" /usr/local/bin/gitlab-runner https://gitlab-runner-downloads.s3.amazonaws.com/latest/binaries/gitlab-runner-linux-amd64\n")])])]),s("h3",{attrs:{id:"设置安装目录可执行"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#设置安装目录可执行"}},[a._v("#")]),a._v(" 设置安装目录可执行")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("chmod")]),a._v(" +x /usr/local/bin/gitlab-runner\n")])])]),s("h3",{attrs:{id:"添加软链接"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#添加软链接"}},[a._v("#")]),a._v(" 添加软链接")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("ln")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-s")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-f")]),a._v(" /usr/local/bin/gitlab-runner /usr/bin/gitlab-runner\n")])])]),s("h3",{attrs:{id:"使用-root-用户权限运行-gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用-root-用户权限运行-gitlab-runner"}},[a._v("#")]),a._v(" 使用 root 用户权限运行 gitlab-runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" gitlab-runner "),s("span",{pre:!0,attrs:{class:"token function"}},[a._v("install")]),a._v(" "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("--user")]),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("root --working-directory"),s("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v("/home/gitlab-runner\n")])])]),s("h3",{attrs:{id:"启动runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#启动runner"}},[a._v("#")]),a._v(" 启动runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[s("span",{pre:!0,attrs:{class:"token function"}},[a._v("sudo")]),a._v(" gitlab-runner start\n")])])]),s("h3",{attrs:{id:"查看版本"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看版本"}},[a._v("#")]),a._v(" 查看版本")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-runner "),s("span",{pre:!0,attrs:{class:"token parameter variable"}},[a._v("-v")]),a._v("\n")])])]),s("h3",{attrs:{id:"查看token-注册runner的时候要用到"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#查看token-注册runner的时候要用到"}},[a._v("#")]),a._v(" 查看token，注册runner的时候要用到")]),a._v(" "),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/19423820-1de92280fc6b0ee9.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"注册gitlab-runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#注册gitlab-runner"}},[a._v("#")]),a._v(" 注册gitlab-runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-runner register\n")])])]),s("p",[s("img",{attrs:{src:"https://upload-images.jianshu.io/upload_images/19423820-ec34079d0f70a67e.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1240",alt:"image.png"}})]),a._v(" "),s("h3",{attrs:{id:"连接runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#连接runner"}},[a._v("#")]),a._v(" 连接runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-runner verify\n")])])]),s("h3",{attrs:{id:"运行runner"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#运行runner"}},[a._v("#")]),a._v(" 运行runner")]),a._v(" "),s("div",{staticClass:"language-bash extra-class"},[s("pre",{pre:!0,attrs:{class:"language-bash"}},[s("code",[a._v("gitlab-runner run\n")])])]),s("blockquote",[s("p",[a._v("终端运行runner才会自动触发CI/CD，不然会一直处于pending状态，有待研究")])])])}),[],!1,null,null,null);s.default=e.exports}}]);